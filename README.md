# Topic : 분산데이터베이스 설계

## 🌠 Team 구구구칠

|<img src="https://avatars.githubusercontent.com/u/87555330?v=4" width="150" height="150"/>|<img src="https://avatars.githubusercontent.com/u/55776421?v=4" width="150" height="150"/>|<img src="https://avatars.githubusercontent.com/u/71498489?v=4" width="150" height="150"/>|<img src="https://avatars.githubusercontent.com/u/82265395?v=4" width="150" height="150"/>|
|:-:|:-:|:-:|:-:|
|김민성<br/>[@minsung159357](https://github.com/minsung159357)|SeulGi_LEE<br/>[@seulg2027](https://github.com/seulg2027)|HanJH<br/>[@letsgojh0810](https://github.com/letsgojh0810)|구민지<br/>[@minjee83](https://github.com/minjee83)|

## 📌 선정이유
- 학부 과정에서 다루는 프로젝트들은 대개 단일 데이터베이스 환경에 국한되어 있습니다. 그러나 현업에서는 방대한 데이터를 안정적으로 관리하기 위해 분산 데이터베이스 아키텍처가 필수적이다.
특히 마이크로서비스 아키텍처의 확산과 글로벌 서비스의 증가로 인해, 분산 데이터베이스의 설계와 운영은 현대 시스템 아키텍처에서 핵심적인 과제다.
이에 단순한 CRUD 작업을 넘어, 실제 엔터프라이즈 환경에 적합한 효율적인 데이터베이스 설계 전략을 연구하고자 본 주제를 선정하게 되었다.

## ⚒️ 구현환경
```
🖥️ Server : Docker

🗄️ DB : postgreSQL
```
## 🗓️ 준비기간
🗓️ `2025.02.03` ~ `2025.02.17`

## 📚 기술세미나 목차
1. 분산 데이터베이스 개요
2. 파티셔닝 (Partitioning)
3. 샤딩 (Sharding)
4. 레플리케이션 (Replication)
5. 구현 예시
6. 비교 분석
7. 프로젝트 결과
8. Q&A

## 📢 기술세미나 주요 내용
### 1️⃣ 분산 데이터베이스 개요  
✔ 분산 데이터베이스란?
- 하나의 데이터베이스를 여러 개의 노드(서버)에 나누어 저장하고 관리하는 시스템
- 확장성, 가용성, 성능을 높이기 위해 파티셔닝, 샤딩, 레플리케이션 등의 방식 적용

✔ CAP 이론
- 분산 시스템에서는 일관성(Consistency), 가용성(Availability), 분할 허용성(Partition Tolerance) 중 3가지 모두를 만족할 수 없음
- 네트워크 장애 발생할 가능성이 항상 존재하기 때문에 분할 허용성은 반드시 허용

✔ 샤딩의 필요성
- 대규모 데이터 처리를 위한 성능 최적화
- 서버 부하 감소 및 확장성 향상
- 특정 샤드 장애 발생 시 격리 효과
  
### 2️⃣ 파티셔닝 (Partitioning)
✔ 파티셔닝이란?
- 테이블을 논리적으로 나누어 관리하는 기법
- 특정 컬럼을 기준으로 수직적(Vertical) / 수평적(Horizontal) 파티셔닝 방식 사용

✔ 장점 & 단점<br>

✅ 데이터 접근 속도 향상<br>
✅ 데이터 관리 효율 증대<br>
❌ 일부 DBMS에서 기능 제한 발생<br>
❌ Join 연산이 많아질 경우 성능 저하 가능<br>

### 3️⃣ 샤딩 (Sharding)
✔ 샤딩이란?
- 한 서버에서 처리할 수 없는 대량 데이터를 여러 개의 샤드(Shard)로 분산 처리하는 기술

✔ 샤딩 방식
- 수직 샤딩 : 데이터의 특정 컬럼을 기준으로 분할
- 수평 샤딩 : 특정 데이터를 샤딩 키로 선정 후 그 데이터의 값을 기준으로 분할
  
✔ 샤딩의 필요성
- 대규모 데이터 처리를 위한 성능 최적화
- 서버 부하 감소 및 확장성 향상
- 특정 샤드 장애 발생 시 격리 효과

### 4️⃣ 레플리케이션 (Replication)  
✔ 레플리케이션이란?
- 데이터를 여러 개의 DB에 복제하여 고가용성(High Availability)을 보장하는 기술

✔ Master-Slave Replication
- Master : 쓰기 전용
- Slave : 읽기 전용 (부하 분산 역할)

✔ 장애 처리 - 페일오버 (Failover)
- Master 장애 발생 시 자동으로 Slave를 Master로 승격하여 서비스 지속 가능

### 💡 구현 예시
🔹1️⃣ 파티셔닝<br>
🔹2️⃣ 샤딩<br>
🔹3️⃣ 샤딩 + 레플리케이션<br>

### 🔍 비교 분석  

#### 📌 해시 샤딩(Sharding) vs 파티셔닝(Partitioning)

| 항목 | 해시 샤딩 (Sharding) | 파티셔닝 (Partitioning) |
|------|----------------------|----------------------|
| 데이터 분배 방식 | 해시 함수 적용 후 샤드에 데이터 저장 | 특정 컬럼 값을 기준으로 데이터 분할 |
| 주요 목적 | 부하 분산 및 성능 최적화 | 데이터 접근 최적화 및 관리 효율성 증가 |
| 적용 방식 | 샤드 개수에 따라 해시 함수 값으로 데이터 분배 | 수직/수평 파티셔닝 방식 사용 |
| 데이터 조회 | 샤딩 키를 기준으로 해당 샤드에서 조회 | 특정 파티션만 조회 가능하여 성능 최적화 |
| 확장성 | 새로운 샤드 추가 가능 (다만 리밸런싱 필요) | 파티션 개수를 조정하여 확장 가능 |
| 주요 활용 사례 | 대규모 트래픽 분산 (SNS, 게임 서버) | 로그 데이터 최적화, OLAP 쿼리 최적화 |

---

#### 📌 샤딩(Sharding) vs 레플리케이션(Replication)

| 항목 | 샤딩 (Sharding) | 레플리케이션 (Replication) |
|------|----------------|----------------|
| 목적 | 데이터 분산 및 성능 향상 | 데이터 복제 및 고가용성 확보 |
| 적용 방식 | 데이터를 여러 개의 샤드에 나누어 저장 | Master-Slave 구조에서 데이터를 복제 |
| 읽기/쓰기 처리 | 샤드마다 독립적인 읽기/쓰기 가능 | Master에서 쓰기, Slave에서 읽기 가능 |
| 장애 대응 | 특정 샤드 장애 시 일부 서비스만 영향 | Master 장애 발생 시 Slave를 Master로 승격 (Failover) |
| 확장성 | 샤드 추가를 통해 확장 가능 | Slave 추가를 통해 읽기 성능 확장 가능 |
| 주요 활용 사례 | 대규모 사용자 트래픽 처리 (SNS, 전자상거래) | 금융 시스템, 클라우드 서비스에서 고가용성 보장 |


### 🏆 프로젝트 결과
✅ 분산 데이터베이스 아키텍처를 직접 구현하고 성능을 분석<br>
✅ PostgreSQL + Citus 기반으로 샤딩 & 레플리케이션 적용 및 성능 테스트 완료<br>
✅ 샤딩을 통한 성능 최적화 효과 확인 (SELECT 속도 10배 향상)<br>
✅ 레플리케이션을 활용한 고가용성 및 장애 대응 전략 검증 완료<br>

### ❓ Q&A
#### ⁉️ 1개의 원본(마스터) 에 여러 레플리카 (슬레이브)가 존재할 때 이들 간의 sync 를 어떻게 맞추는지 궁금합니다.

🛡️ [답변] : <br>

모든 슬레이브가 데이터를 복제할 때까지 마스터가 기다리는 동기식 리플리케이션 방식을 사용하며, 일관성이 보장되지만 속도가 느리다는 단점이 있음.

#### ⁉️ 금융권에서는 어떤 분산데이터베이스 전략을 사용하는지 궁금하고 왜 그런지 알고 계시면 설명 부탁드립니다.

🛡️ [답변] : <br>

금융권에서는 장애 발생 시 데이터 유실을 방지하기 위해 이중화 전략을 사용하며 Master-Master (멀티 마스터) 방식을 이용.
이 방식은 두 개 이상의 데이터센터에서 동시에 운영하여 장애 발생 시 자동으로 다른 노드로 트랜잭션 처리함.

#### ⁉️ 조회 삽입 성능에서 파티셔닝이 우수하다고 했는데 B+트리와 같은 인덱스와 성능 비교시 어느 것이 우수하다고 비교가 될까요?

🛡️ [답변] : <br>

랜덤 조회가 많은 경우에는 B+트리 인덱스가 유리하고, 대량 데이터 처리 및 삽입 성능을 고려할 때는 파티셔닝이 더 강력한 성능을 발휘함. 즉, 상황에 따라 성능이 다름.

#### ⁉️ 구현 시 데이터베이스 중에 postgresql을 고른 이유와 다른 db와의 다른점이 있으면 알려주세요.

🛡️ [답변] : <br>

postgresql 내에서 지원하는 Citus 확장 기능을 활용하여 샤딩을 간단하게 구현 가능.
대부분의 db 가 샤딩을 지원하는 라이브러리가 없음.

#### ⁉️ cap중에서 현대의 분산 시스템은 어떠한 요소를 최우선으로 설계하고 있나요?

🛡️ [답변] : <br>

최근의 클라우드 기반 시스템에서는 가용성(Availability)과 분할 허용성(Partition Tolerance)을 우선하는 경우가 많지만 금융권 등에서는 일관성(Consistency)도 중요하여 CP 시스템을 선택하는 경우가 많음.

